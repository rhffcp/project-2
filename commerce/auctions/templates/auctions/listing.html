{% extends "auctions/layout.html" %}

{% block body %}
    {% if listing.status == False %}
        {% if user != winner %}
            <!-- add option for deleting listing if user is creator. -->
            <div class="alert alert-danger" role="alert">
                Listing closed. User: "{{ winner }}" is the winner.
            </div>
        {% endif %}
   
        {% if user == winner %}
            <div class="alert alert-success" role="alert">
                Congratulations! You are the winner for this listing!
            </div>
        {% endif %}
    {% else %}
        {% if error %}
            <div class="alert alert-danger" role="alert">
                Error: Bid must be greater than current price.
            </div>
        {% elif bid_placed %}
        <!-- add option for user to undo their bid. in a view use listing.current_bid = Bid.objects.filter(listing=listing).last().new_bid -->
            <div class="alert alert-warning" role="alert">
                Your bid is now the current price!
            </div>
        {% endif %}

        <h2>{{ listing.title }}</h2>

        {% if logged_in %}
            {% if user != listing.creator %}
            <!-- add option for deleting listing if user is creator. -->
                <div>
                    <a href="{% url 'edit_watchlist' listing.id %}">
                        {% if exist %}
                            Remove from Watchlist
                        {% else %}
                            Add to Watchlist
                        {% endif %}
                    </a>
                </div>
            {% endif %}
        {% endif %}

        <div>
            <img src="{{ listing.image.url }}">
        </div>
        <div>
            {{ listing.description }}
        </div>
        <div>
            {% if listing.current_bid is None %}
                Price: ${{ listing.starting_bid }}
            {% else %}
                Price: ${{ listing.current_bid }}
            {% endif %}
        </div>

        {% if logged_in %}
            {% if user != listing.creator %}
                <div>
                    <form action="{% url 'listing' listing.id %}" method="post">
                        {% csrf_token %}
                        <div>
                            {{ form.new_bid }}
                        </div>
                        <div>
                            <input class="btn btn-primary btn-sm" type="submit" value="Place Bid">
                        </div>
                    </form>
                </div>
            {% else %}
            <!-- add option for creator to edit title description price or photo. -->
                <div>
                    <form action="{% url 'winner' listing.id %}" method="post">
                        {% csrf_token %}
                        <div>
                            <input class="btn btn-primary btn-sm" type="submit" value="Close Auction">
                        </div>
                    </form>
                </div>
            {% endif %}

            <div>
                <form action="{% url 'comments' listing.id %}" method="post">
                    {% csrf_token %}
                    <div>
                        {{ comment_form.comment }}
                    </div>
                    <div>
                        <input class="btn btn-primary btn-sm" type="submit" value="Comment">
                    </div>
                </form>
            </div>

            <div>
                <h3>All Comments</h3>
    
                {% if comments %}
                    <div>
                        {% for comment in comments %}
                            <div>
                                {{ comment.user }}: {{ comment }}
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div>
                        No comments.
                    </div>
                {% endif %}
            </div>
        {% endif %}
    {% endif %}
{% endblock %}